#include "hilbert.h"

double hilbert_kernel[511] = {
    0.000199803, 0., 0.000201734, 0., 0.000204404, 0., 0.000207831, 0., 
    0.000212031, 0., 0.000217022, 0., 0.000222821, 0., 0.000229447, 0., 
    0.000236917, 0., 0.000245249, 0., 0.00025446, 0., 0.000264571, 0., 
    0.000275598, 0., 0.000287561, 0., 0.000300478, 0., 0.000314368, 0., 
    0.000329252, 0., 0.000345148, 0., 0.000362076, 0., 0.000380057, 0., 
    0.00039911, 0., 0.000419257, 0., 0.000440518, 0., 0.000462916, 0., 
    0.000486471, 0., 0.000511205, 0., 0.000537143, 0., 0.000564306, 0., 
    0.000592717, 0., 0.000622403, 0., 0.000653386, 0., 0.000685692, 0., 
    0.000719347, 0., 0.000754378, 0., 0.000790812, 0., 0.000828677, 0., 
    0.000868002, 0., 0.000908817, 0., 0.000951152, 0., 0.00099504, 0., 
    0.00104051, 0., 0.00108761, 0., 0.00113635, 0., 0.00118679, 0., 
    0.00123896, 0., 0.00129289, 0., 0.00134864, 0., 0.00140624, 0., 
    0.00146573, 0., 0.00152717, 0., 0.00159061, 0., 0.00165609, 0., 
    0.00172367, 0., 0.0017934, 0., 0.00186534, 0., 0.00193957, 0., 
    0.00201613, 0., 0.00209511, 0., 0.00217657, 0., 0.0022606, 0., 
    0.00234726, 0., 0.00243666, 0., 0.00252888, 0., 0.00262401, 0., 
    0.00272217, 0., 0.00282347, 0., 0.00292801, 0., 0.00303592, 0., 
    0.00314735, 0., 0.00326242, 0., 0.0033813, 0., 0.00350414, 0., 
    0.00363113, 0., 0.00376245, 0., 0.0038983, 0., 0.0040389, 0., 
    0.00418449, 0., 0.00433532, 0., 0.00449167, 0., 0.00465384, 0., 
    0.00482215, 0., 0.00499695, 0., 0.00517863, 0., 0.0053676, 0., 
    0.00556433, 0., 0.00576932, 0., 0.00598312, 0., 0.00620633, 0., 
    0.00643962, 0., 0.00668372, 0., 0.00693947, 0., 0.00720776, 0., 
    0.00748961, 0., 0.00778615, 0., 0.00809863, 0., 0.00842849, 0., 
    0.00877733, 0., 0.00914696, 0., 0.00953946, 0., 0.00995716, 0., 
    0.0104028, 0., 0.0108794, 0., 0.0113906, 0., 0.0119407, 0., 
    0.0125344, 0., 0.0131776, 0., 0.0138771, 0., 0.0146412, 0., 
    0.0154795, 0., 0.0164043, 0., 0.0174302, 0., 0.0185755, 0., 
    0.0198634, 0., 0.0213232, 0., 0.0229931, 0., 0.0249235, 0., 
    0.0271822, 0., 0.029863, 0., 0.0330991, 0., 0.0370865, 0., 0.0421257, 
    0., 0.0487018, 0., 0.0576534, 0., 0.0705638, 0., 0.0908263, 0., 
    0.127264, 0., 0.212224, 0., 0.636851, 0., -0.636851, 0., -0.212224, 
    0., -0.127264, 0., -0.0908263, 0., -0.0705638, 0., -0.0576534, 0., 
    -0.0487018, 0., -0.0421257, 0., -0.0370865, 0., -0.0330991, 0., 
    -0.029863, 0., -0.0271822, 0., -0.0249235, 0., -0.0229931, 0., 
    -0.0213232, 0., -0.0198634, 0., -0.0185755, 0., -0.0174302, 0., 
    -0.0164043, 0., -0.0154795, 0., -0.0146412, 0., -0.0138771, 0., 
    -0.0131776, 0., -0.0125344, 0., -0.0119407, 0., -0.0113906, 0., 
    -0.0108794, 0., -0.0104028, 0., -0.00995716, 0., -0.00953946, 0., 
    -0.00914696, 0., -0.00877733, 0., -0.00842849, 0., -0.00809863, 0., 
    -0.00778615, 0., -0.00748961, 0., -0.00720776, 0., -0.00693947, 0., 
    -0.00668372, 0., -0.00643962, 0., -0.00620633, 0., -0.00598312, 0., 
    -0.00576932, 0., -0.00556433, 0., -0.0053676, 0., -0.00517863, 0., 
    -0.00499695, 0., -0.00482215, 0., -0.00465384, 0., -0.00449167, 0., 
    -0.00433532, 0., -0.00418449, 0., -0.0040389, 0., -0.0038983, 0., 
    -0.00376245, 0., -0.00363113, 0., -0.00350414, 0., -0.0033813, 0., 
    -0.00326242, 0., -0.00314735, 0., -0.00303592, 0., -0.00292801, 0., 
    -0.00282347, 0., -0.00272217, 0., -0.00262401, 0., -0.00252888, 0., 
    -0.00243666, 0., -0.00234726, 0., -0.0022606, 0., -0.00217657, 0., 
    -0.00209511, 0., -0.00201613, 0., -0.00193957, 0., -0.00186534, 0., 
    -0.0017934, 0., -0.00172367, 0., -0.00165609, 0., -0.00159061, 0., 
    -0.00152717, 0., -0.00146573, 0., -0.00140624, 0., -0.00134864, 0., 
    -0.00129289, 0., -0.00123896, 0., -0.00118679, 0., -0.00113635, 0., 
    -0.00108761, 0., -0.00104051, 0., -0.00099504, 0., -0.000951152, 0., 
    -0.000908817, 0., -0.000868002, 0., -0.000828677, 0., -0.000790812, 
    0., -0.000754378, 0., -0.000719347, 0., -0.000685692, 0., 
    -0.000653386, 0., -0.000622403, 0., -0.000592717, 0., -0.000564306, 
    0., -0.000537143, 0., -0.000511205, 0., -0.000486471, 0., 
    -0.000462916, 0., -0.000440518, 0., -0.000419257, 0., -0.00039911, 
    0., -0.000380057, 0., -0.000362076, 0., -0.000345148, 0., 
    -0.000329252, 0., -0.000314368, 0., -0.000300478, 0., -0.000287561, 
    0., -0.000275598, 0., -0.000264571, 0., -0.00025446, 0., 
    -0.000245249, 0., -0.000236917, 0., -0.000229447, 0., -0.000222821, 
    0., -0.000217022, 0., -0.000212031, 0., -0.000207831, 0., 
    -0.000204404, 0., -0.000201734, 0., -0.000199803
};

void hilbert_init(struct Hilbert *hilbert) {
    for (int i = 0; i < 511; ++i) {
        hilbert->data[i] = 0;
    }
    hilbert->ptr = 0;
}

void hilbert_exec(struct Hilbert *hilbert, double sample, double *i, double *q) {
    hilbert->data[hilbert->ptr] = sample;
    double t = 0;
    for (int j = 0; j < 511; ++j) {
        int p = hilbert->ptr+j;
        t += hilbert_kernel[j]*hilbert->data[p < 511 ? p : p-511];
    }
    *i = hilbert->data[255];
    *q = t;
    ++hilbert->ptr;
}
